<!-- 实现图片预览功能,点击链接下载功能 -->
<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Document</title>
  </head>
  <body>
    <input type="file" name="" id="" />
    <script>
      const fileInput = document.querySelector('input');

      const reader = new FileReader();
      reader.addEventListener('load', (event) => {
        console.log('hello file has been prased');
        const contents = event.target.result;
        const img = document.createElement('img');
        img.setAttribute('src', contents);
        document.querySelector('body').appendChild(img);
        // 点击链接下载文件
        const a = document.createElement('a');
        a.setAttribute('href', contents);
        a.innerText = 'click to download';
        document.querySelector('body').append(a);
      });
      reader.onerror = () => {
        alert('file prase error');
      };
      // 获取文件
      fileInput.addEventListener('change', (e) => {
        const file = e.target.files[0];
        console.log('have upload file', file);
        // 为了将文件读取为DataURL，需要将file转换成Blob对象。
        // 让reader将文件转化成合适的形式，转化成DataURL形式，写在img的src属性里可以完成图片预览功能
        // 成为这个格式意味着把图像用Base64编码，可以传给服务器，之后服务器再把Base64编码转成二进制文件就好。
        // 当我们需要处理上传的文件时，通常先将 File 对象转换为 Blob 对象。
        reader.readAsDataURL(new Blob([file]));
        //Blob 类型来处理二进制数据，例如上传文件、下载文件。而 File 类型则更多地用于表示用户上传的文件信息，具有一些额外的属性和方法，例如文件名、文件大小等。
      });
    </script>
  </body>
</html>
