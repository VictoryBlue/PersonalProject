<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8" />
    <title>Resume Editor</title>
  </head>
  <style>
    #editor {
      height: 300px;
      border: 1px solid gray;
    }
  </style>
  <script src="https://cdn.jsdelivr.net/npm/@editorjs/header@2.7.0/dist/bundle.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/@editorjs/paragraph@2.9.0/dist/bundle.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/@editorjs/editorjs@2.23.0"></script>
  <script src="https://cdn.jsdelivr.net/npm/@editorjs/list@1.8.0/dist/bundle.min.js"></script>
  <!-- <script src="https://cdn.jsdelivr.net/npm/@editorjs/paragraph@2.22.2"></script> -->
  <!-- <script src="https://cdn.jsdelivr.net/npm/@editorjs/header@2.22.2"></script> -->
  <!-- <script src="https://cdn.jsdelivr.net/npm/@editorjs/list@2.22.2"></script> -->

  <body>
    <h1>Resume Editor</h1>
    <form id="uploadForm">
      <input type="file" name="resume" accept=".pdf,.doc,.docx" />
      <input type="submit" value="Upload" />
    </form>
    <hr />
    <div id="editor"></div>
    <hr />
    <button id="editButton" disabled>Edit Resume</button>
    <button id="downloadButton" disabled>Download Resume</button>
    <div id="status"></div>
  </body>
  <script>
    const API_KEY = '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';
    const editor = new EditorJS({
      holder: 'editor',
      autofocus: true,
      tools: {
        paragraph: {
          class: Paragraph,
          inlineToolbar: true,
        },
        header: {
          class: Header,
          inlineToolbar: true,
        },
        list: {
          class: List,
          inlineToolbar: true,
        },
      },
    });

    const uploadForm = document.getElementById('uploadForm');
    uploadForm.addEventListener('submit', handleUpload);

    const editButton = document.getElementById('editButton');
    editButton.addEventListener('click', handleEdit);

    const downloadButton = document.getElementById('downloadButton');
    downloadButton.addEventListener('click', handleDownload);

    function handleUpload(event) {
      event.preventDefault();
      const file = event.target.resume.files[0];
      if (!file) return;
      const reader = new FileReader();
      reader.readAsDataURL(file);
      reader.onload = function () {
        const data = reader.result.split(',')[1];
        const url = `https://api.openai.com/v1/engines/davinci-codex/completions?prompt=${encodeURIComponent(
          data
        )}&max_tokens=2048&temperature=0.7`;
        fetch(url, {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json',
            Authorization: `Bearer ${API_KEY}`,
          },
        })
          .then((response) => response.json())
          .then((data) => {
            const content = data.choices[0].text.trim();
            editor.render({
              blocks: [{ type: 'paragraph', data: { text: content } }],
            });
            editButton.disabled = false;
          })
          .catch((error) => {
            console.error(error);
            setStatus('Failed to parse resume');
          });
      };
    }
    function handleEdit() {
      editor.readOnly = false;
      editButton.disabled = true;
      downloadButton.disabled = false;
      setStatus(
        'Edit the resume and click the Download button to save changes'
      );
    }

    function handleDownload() {
      const content = editor.save().blocks[0].data.text;
      const url = 'https://api.openai.com/v1/files/upload';
      fetch(url, {
        method: 'POST',
        headers: {
          "Content-Type": 'application/json',
          Authorization: `Bearer ${API_KEY}`,
        },
        body: JSON.stringify({ purpose: 'resume', file: content }),
      })
        .then((response) => response.json())
        .then((data) => {
          const fileId = data.id;
          const downloadUrl = `https://api.openai.com/v1/files/${fileId}/download;`;
          window.open(downloadUrl, '_blank');
          setStatus('Resume downloaded successfully');
        })
        .catch((error) => {
          console.error(error);
          setStatus('Failed to download resume');
        });
    }

    function setStatus(message) {
      const status = document.getElementById('status');
      status.textContent = message;
    }
  </script>
</html>
